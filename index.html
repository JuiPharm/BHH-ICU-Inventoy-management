<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICU Stock Management</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div id="app">
        <!-- Login Screen -->
        <div id="loginScreen" class="screen active">
            <div class="login-container">
                <div class="login-header">
                    <i class="fas fa-heartbeat"></i>
                    <h1>ICU Stock Management</h1>
                    <p>ระบบจัดการคลังยาและเวชภัณฑ์ ICU</p>
                </div>
                
                <div class="login-form">
                    <div class="form-group">
                        <label for="staffId">รหัสพนักงาน</label>
                        <input type="text" id="staffId" placeholder="กรอกรหัสพนักงาน" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">รหัสผ่าน</label>
                        <div class="password-input">
                            <input type="password" id="password" placeholder="กรอกรหัสผ่าน" required>
                            <button type="button" class="toggle-password" onclick="togglePassword()">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button type="button" class="btn-login" onclick="login()">
                        <i class="fas fa-sign-in-alt"></i>
                        เข้าสู่ระบบ
                    </button>
                </div>
                
                <div class="login-footer">
                    <p>กรุณาตั้งค่า API URL ในไฟล์ config.js ก่อนใช้งาน</p>
                </div>
            </div>
        </div>

        <!-- Main Application -->
        <div id="mainScreen" class="screen">
            <!-- Header -->
            <header class="app-header">
                <div class="header-left">
                    <h1><i class="fas fa-heartbeat"></i> ICU Stock Management</h1>
                </div>
                
                <div class="header-right">
                    <div class="user-info">
                        <span id="userName"></span>
                        <span id="userRole" class="role-badge"></span>
                    </div>
                    <button class="btn-logout" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        ออกจากระบบ
                    </button>
                </div>
            </header>

            <!-- Navigation Tabs -->
            <nav class="app-nav">
                <button class="nav-tab active" data-tab="inventory" onclick="switchTab('inventory')">
                    <i class="fas fa-boxes"></i>
                    คลังสินค้า
                </button>
                <button class="nav-tab" data-tab="dailyCheck" onclick="switchTab('dailyCheck')">
                    <i class="fas fa-clipboard-check"></i>
                    ตรวจเช็ค
                </button>
                <button class="nav-tab" data-tab="reorder" onclick="switchTab('reorder')">
                    <i class="fas fa-exclamation-triangle"></i>
                    สั่งซื้อ
                </button>
                <button class="nav-tab" data-tab="expired" onclick="switchTab('expired')">
                    <i class="fas fa-calendar-times"></i>
                    หมดอายุ
                </button>
                <button class="nav-tab" data-tab="usage" onclick="switchTab('usage')">
                    <i class="fas fa-chart-line"></i>
                    การเบิกใช้
                </button>
                <button class="nav-tab" data-tab="reports" onclick="switchTab('reports')">
                    <i class="fas fa-file-alt"></i>
                    รายงาน
                </button>
                <button class="nav-tab admin-only" data-tab="admin" onclick="switchTab('admin')" style="display:none;">
                    <i class="fas fa-cogs"></i>
                    ตั้งค่า
                </button>
            </nav>

            <!-- Main Content -->
            <main class="app-content">
                <!-- Inventory Tab -->
                <div id="inventoryTab" class="tab-content active">
                    <div class="tab-header">
                        <h2><i class="fas fa-boxes"></i> คลังสินค้า</h2>
                        <div class="tab-actions">
                            <button class="btn-primary" onclick="showAddItemModal()">
                                <i class="fas fa-plus"></i>
                                เพิ่มรายการ
                            </button>
                            <button class="btn-secondary" onclick="refreshInventory()">
                                <i class="fas fa-sync-alt"></i>
                                โหลดใหม่
                            </button>
                        </div>
                    </div>
                    
                    <div class="search-bar">
                        <input type="text" id="inventorySearch" placeholder="ค้นหาสินค้า..." onkeyup="searchInventory()">
                        <i class="fas fa-search"></i>
                    </div>
                    
                    <div class="table-container">
                        <table id="inventoryTable" class="data-table">
                            <thead>
                                <tr>
                                    <th>รายการ</th>
                                    <th>Lot No</th>
                                    <th>จำนวน</th>
                                    <th>Minimum Stock</th>
                                    <th>วันหมดอายุ</th>
                                    <th>ตู้</th>
                                    <th>ประเภท</th>
                                    <th>จัดการ</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTableBody">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Daily Check Tab -->
                <div id="dailyCheckTab" class="tab-content">
                    <div class="tab-header">
                        <h2><i class="fas fa-clipboard-check"></i> ตรวจเช็คประจำวัน</h2>
                        <div class="tab-actions">
                            <button class="btn-primary" onclick="saveDailyCheck()">
                                <i class="fas fa-save"></i>
                                บันทึกการตรวจ
                            </button>
                        </div>
                    </div>
                    
                    <div class="check-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>วันที่</label>
                                <input type="date" id="checkDate" required>
                            </div>
                            <div class="form-group">
                                <label>รอบ</label>
                                <select id="checkRound" required>
                                    <option value="">เลือกรอบ</option>
                                    <option value="เช้า">เช้า (08:00-16:00)</option>
                                    <option value="บ่าย">บ่าย (16:00-24:00)</option>
                                    <option value="ดึก">ดึก (00:00-08:00)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="check-items">
                        <h3>รายการที่ต้องตรวจ</h3>
                        <div id="checkItemsList">
                            <!-- Items will be loaded here based on user role -->
                        </div>
                    </div>
                </div>

                <!-- Reorder Tab -->
                <div id="reorderTab" class="tab-content">
                    <div class="tab-header">
                        <h2><i class="fas fa-exclamation-triangle"></i> รายการต้องสั่งซื้อ</h2>
                        <button class="btn-secondary" onclick="refreshReorderItems()">
                            <i class="fas fa-sync-alt"></i>
                            โหลดใหม่
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>รายการ</th>
                                    <th>จำนวนปัจจุบัน</th>
                                    <th>Minimum Stock</th>
                                    <th>จำนวนต้องสั่ง</th>
                                    <th>ความเร่งด่วน</th>
                                </tr>
                            </thead>
                            <tbody id="reorderTableBody">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Expired Tab -->
                <div id="expiredTab" class="tab-content">
                    <div class="tab-header">
                        <h2><i class="fas fa-calendar-times"></i> รายการหมดอายุ</h2>
                        <button class="btn-secondary" onclick="refreshExpiredItems()">
                            <i class="fas fa-sync-alt"></i>
                            โหลดใหม่
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>รายการ</th>
                                    <th>Lot No</th>
                                    <th>จำนวน</th>
                                    <th>วันหมดอายุ</th>
                                    <th>สถานะ</th>
                                </tr>
                            </thead>
                            <tbody id="expiredTableBody">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Usage Tab -->
                <div id="usageTab" class="tab-content">
                    <div class="tab-header">
                        <h2><i class="fas fa-chart-line"></i> การเบิกใช้</h2>
                        <div class="tab-actions">
                            <button class="btn-primary" onclick="showRecordUsageModal()">
                                <i class="fas fa-plus"></i>
                                บันทึกการเบิก
                            </button>
                            <button class="btn-secondary" onclick="refreshUsageLogs()">
                                <i class="fas fa-sync-alt"></i>
                                โหลดใหม่
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>วันที่</th>
                                    <th>รายการ</th>
                                    <th>Lot No</th>
                                    <th>จำนวนที่เบิก</th>
                                    <th>ผู้เบิก</th>
                                </tr>
                            </thead>
                            <tbody id="usageTableBody">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Reports Tab -->
                <div id="reportsTab" class="tab-content">
                    <div class="tab-header">
                        <h2><i class="fas fa-file-alt"></i> รายงาน</h2>
                    </div>
                    
                    <div class="reports-grid">
                        <div class="report-card">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3>สรุปสินค้าขาด</h3>
                            <p>รายการสินค้าที่ต่ำกว่า Minimum Stock</p>
                            <button class="btn-primary" onclick="generateReorderReport()">
                                ดูรายงาน
                            </button>
                        </div>
                        
                        <div class="report-card">
                            <i class="fas fa-calendar-times"></i>
                            <h3>สรุปสินค้าหมดอายุ</h3>
                            <p>รายการสินค้าที่หมดอายุแล้ว</p>
                            <button class="btn-primary" onclick="generateExpiredReport()">
                                ดูรายงาน
                            </button>
                        </div>
                        
                        <div class="report-card">
                            <i class="fas fa-chart-line"></i>
                            <h3>สรุปการเบิกใช้</h3>
                            <p>สถิติการเบิกใช้สินค้า</p>
                            <button class="btn-primary" onclick="generateUsageReport()">
                                ดูรายงาน
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Admin Tab -->
                <div id="adminTab" class="tab-content">
                    <div class="tab-header">
                        <h2><i class="fas fa-cogs"></i> ตั้งค่าระบบ</h2>
                    </div>
                    
                    <div class="admin-grid">
                        <div class="admin-card">
                            <i class="fas fa-users"></i>
                            <h3>จัดการผู้ใช้</h3>
                            <p>เพิ่ม/แก้ไข/ลบ ผู้ใช้งานระบบ</p>
                            <button class="btn-primary" onclick="showStaffManagement()">
                                จัดการผู้ใช้
                            </button>
                        </div>
                        
                        <div class="admin-card">
                            <i class="fas fa-envelope"></i>
                            <h3>อีเมลแจ้งเตือน</h3>
                            <p>ตั้งค่าผู้รับอีเมลแจ้งเตือน</p>
                            <button class="btn-primary" onclick="showEmailSettings()">
                                ตั้งค่าอีเมล
                            </button>
                        </div>
                        
                        <div class="admin-card">
                            <i class="fas fa-database"></i>
                            <h3>สำรองข้อมูล</h3>
                            <p>สร้างไฟล์สำรองข้อมูล</p>
                            <button class="btn-primary" onclick="backupData()">
                                สำรองข้อมูล
                            </button>
                        </div>
                        
                        <div class="admin-card">
                            <i class="fas fa-bell"></i>
                            <h3>ตั้งค่าการแจ้งเตือน</h3>
                            <p>ตั้งค่าการแจ้งเตือนอัตโนมัติ</p>
                            <button class="btn-primary" onclick="setupNotifications()">
                                ตั้งค่าแจ้งเตือน
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>กำลังโหลด...</p>
        </div>
    </div>

    <!-- Message Box -->
    <div id="messageBox" class="message-box">
        <div class="message-content">
            <i class="message-icon"></i>
            <div class="message-text">
                <h4 class="message-title"></h4>
                <p class="message-body"></p>
            </div>
            <button class="message-close" onclick="hideMessage()">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add/Edit Item Modal -->
    <div id="itemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="itemModalTitle">เพิ่มรายการสินค้า</h3>
                <button class="modal-close" onclick="closeItemModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="itemForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>รายการ</label>
                            <input type="text" id="itemName" required>
                        </div>
                        <div class="form-group">
                            <label>Lot No</label>
                            <input type="text" id="itemLotNo" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>จำนวน</label>
                            <input type="number" id="itemQuantity" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>Minimum Stock</label>
                            <input type="number" id="itemMinStock" min="0" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>วันหมดอายุ</label>
                            <input type="date" id="itemExpiryDate">
                        </div>
                        <div class="form-group">
                            <label>ตู้</label>
                            <input type="text" id="itemCabinet">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>ประเภท</label>
                            <select id="itemCategory" required>
                                <option value="">เลือกประเภท</option>
                                <option value="Medicine">ยา</option>
                                <option value="Medical Supply">เวชภัณฑ์</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>หมายเหตุ</label>
                            <input type="text" id="itemNotes">
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="closeItemModal()">ยกเลิก</button>
                        <button type="submit" class="btn-primary">บันทึก</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Record Usage Modal -->
    <div id="usageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>บันทึกการเบิกใช้</h3>
                <button class="modal-close" onclick="closeUsageModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="usageForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>วันที่</label>
                            <input type="date" id="usageDate" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>รายการ</label>
                            <select id="usageItem" required>
                                <option value="">เลือกรายการ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Lot No</label>
                            <select id="usageLotNo" required>
                                <option value="">เลือก Lot No</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>จำนวนที่เบิก</label>
                            <input type="number" id="usageQuantity" min="1" required>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="closeUsageModal()">ยกเลิก</button>
                        <button type="submit" class="btn-primary">บันทึก</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuid.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
