<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ICU Stock Management</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Your existing class-based UI styles (for elements rendered by app.js) -->
  <link rel="stylesheet" href="styles.css" />

  <script>
    // Edit only this line after you deploy Apps Script (exec URL):
    window.API_BASE_URL = "https://script.google.com/macros/s/AKfycbxk8YusmqCrn0fcPITsHYS_9UIYu9mdT-3R-pKjDyOy8R3TuLekUW0akCm0iWd_X_kcuA/exec"; // https://script.google.com/macros/s/.../exec
  </script>
</head>

<body class="min-h-screen bg-slate-950 text-slate-100">
  <!-- App Shell -->
  <div class="min-h-screen">

    <!-- Desktop Sidebar (Fixed) -->
    <aside id="sidebar" hidden
      class="hidden md:flex fixed left-0 top-0 h-screen w-64 flex-col border-r border-white/10 bg-slate-950/70 backdrop-blur">
      <div class="p-4">
        <div class="flex items-center gap-3">
          <img
            src="https://lh5.googleusercontent.com/d/1r7PM1ogHIbxskvcauVIYaQOfSHXWGncO"
            alt="Logo"
            class="h-10 w-10 rounded-xl object-cover ring-1 ring-white/10"
          />
          <div>
            <div class="text-sm font-semibold leading-tight">ICU Stock Management</div>
            <div class="text-xs text-slate-400">GitHub Pages UI • Apps Script API</div>
          </div>
        </div>

        <div class="mt-4 text-xs text-slate-400">
          เมนู (Desktop): แสดงทั้งหมด • (Mobile): ใช้ Bottom Nav
        </div>
      </div>

      <!-- IMPORTANT: app.js will render menu buttons into #tabs -->
      <nav class="px-3 pb-4 overflow-y-auto">
        <div id="tabs" class="flex flex-col gap-1"></div>
      </nav>

      <div class="mt-auto p-4 text-xs text-slate-500 border-t border-white/10">
        <div>TIMEZONE: Asia/Bangkok</div>
        <div>LOCALE: th-TH</div>
      </div>
    </aside>

    <!-- Main Column -->
    <div class="md:pl-64 min-h-screen">

      <!-- Top Bar -->
      <header class="sticky top-0 z-20 border-b border-white/10 bg-slate-950/70 backdrop-blur">
        <div class="px-4 py-3 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <img
              src="https://lh5.googleusercontent.com/d/1r7PM1ogHIbxskvcauVIYaQOfSHXWGncO"
              alt="Logo"
              class="h-9 w-9 rounded-xl object-cover ring-1 ring-white/10 md:hidden"
            />
            <div>
              <div class="text-sm font-semibold">Dashboard</div>
              <div class="text-xs text-slate-400">ICU Stock Management</div>
            </div>
          </div>

          <!-- IMPORTANT: app.js controls #userBox / #userName / #userRole / #btnLogout -->
          <div id="userBox" hidden class="flex items-center gap-3">
            <div class="text-right">
              <div class="text-sm">
                <span id="userName" class="font-semibold"></span>
                <span class="text-slate-400">•</span>
                <span id="userRole" class="text-slate-300"></span>
              </div>
              <div class="text-xs text-slate-400">Session via sessionStorage</div>
            </div>
            <button class="btn btn-secondary" id="btnLogout" type="button">Logout</button>
          </div>
        </div>
      </header>

      <!-- Content -->
      <main class="px-4 py-6 pb-28 md:pb-6">

        <!-- Login View -->
        <section id="loginView"
          class="max-w-3xl mx-auto card">
          <div class="flex items-center gap-3 mb-4">
            <img
              src="https://lh5.googleusercontent.com/d/1r7PM1ogHIbxskvcauVIYaQOfSHXWGncO"
              alt="Logo"
              class="h-12 w-12 rounded-2xl object-cover ring-1 ring-white/10"
            />
            <div>
              <h2 class="text-xl font-semibold">Login</h2>
              <div class="text-sm text-slate-400">เข้าสู่ระบบเพื่อใช้งานเมนู Stock / Daily Check / Reports</div>
            </div>
          </div>

          <div class="grid2">
            <label>
              <div class="label">StaffID</div>
              <input id="loginStaffId" type="text" autocomplete="username" placeholder="เช่น admin" />
            </label>

            <label>
              <div class="label">Password</div>
              <div class="row">
                <input id="loginPassword" type="password" autocomplete="current-password" placeholder="Password" />
                <button class="btn btn-secondary" id="btnTogglePw" type="button">Show</button>
              </div>
            </label>
          </div>

          <div class="row gap mt-3">
            <button class="btn" id="btnLogin" type="button">Login</button>
            <button class="btn btn-secondary" id="btnFirstTimeInit" type="button">
              First-time setup: Initialize Sheets
            </button>
          </div>

          <div class="hint mt-3">
            หากเพิ่งเริ่มใช้งานครั้งแรก ให้กด “Initialize Sheets” เพื่อสร้างชีต/หัวตารางและสร้างบัญชีผู้ดูแลเริ่มต้น
          </div>

          <div id="loginInfo" class="info mt-3" hidden></div>
        </section>

        <!-- App View -->
        <section id="appView" hidden>
          <div class="panel card">
            <div class="panel-head">
              <h2 id="panelTitle" class="text-lg font-semibold">Inventory</h2>
              <div class="panel-actions" id="panelActions"></div>
            </div>
            <div id="panelBody"></div>
          </div>
        </section>

      </main>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav id="bottomNav" hidden
      class="md:hidden fixed bottom-0 left-0 right-0 z-30 border-t border-white/10 bg-slate-950/80 backdrop-blur">
      <div class="px-2 py-2 flex items-stretch justify-between gap-2">
        <button class="nav-btn" data-go-tab="inventory" id="navHome">Home</button>
        <button class="nav-btn" data-go-tab="inventory" id="navInventory">Inventory</button>

        <!-- Admin special middle button -->
        <button class="nav-btn nav-btn-primary" data-toggle-sheet="1" id="navMenu" hidden>Menu</button>

        <button class="nav-btn" data-go-tab="daily" id="navDaily">Daily</button>
        <button class="nav-btn" data-go-tab="usage" id="navUsage">Usage</button>
      </div>
    </nav>

    <!-- Expandable Bottom Sheet / Action Sheet -->
    <div id="actionSheet" hidden class="md:hidden fixed inset-0 z-40">
      <div id="sheetBackdrop" class="absolute inset-0 bg-black/60"></div>

      <div class="absolute left-0 right-0 bottom-0 p-3">
        <div class="rounded-2xl border border-white/10 bg-slate-900/95 backdrop-blur shadow-xl">
          <div class="flex items-center justify-between px-4 py-3 border-b border-white/10">
            <div class="font-semibold">Menu</div>
            <button class="btn btn-secondary btn-sm" data-close-sheet="1" type="button">✕</button>
          </div>

          <div class="p-4">
            <div class="text-xs text-slate-400 mb-3">
              Action Sheet (Mobile): กดเมนูเพื่อสลับแท็บ • ระบบจะปิดแผงอัตโนมัติ
            </div>

            <div class="grid grid-cols-3 gap-2">
              <button class="sheet-btn" data-go-tab="inventory" type="button">Inventory</button>
              <button class="sheet-btn" data-go-tab="daily" type="button">Daily Check</button>
              <button class="sheet-btn" data-go-tab="usage" type="button">Usage Logs</button>
              <button class="sheet-btn" data-go-tab="reorder" type="button">Reorder</button>
              <button class="sheet-btn" data-go-tab="expired" type="button">Expired</button>
              <button class="sheet-btn" data-go-tab="shift" type="button">Shift Summary</button>

              <!-- Admin-only entry (will be toggled by app.js) -->
              <button class="sheet-btn" data-go-tab="admin" id="sheetAdminBtn" hidden type="button">Admin Console</button>
            </div>

            <div class="mt-3 text-xs text-slate-400">
              Tip: เมนู Admin Console จะปรากฏเฉพาะ role=Admin
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" hidden class="fixed inset-0 z-50 grid place-items-center bg-black/60">
      <div class="rounded-2xl border border-white/10 bg-slate-900/90 backdrop-blur p-5 text-center">
        <div class="mx-auto h-10 w-10 rounded-full border-2 border-white/20 border-t-white animate-spin"></div>
        <div class="mt-3 text-sm text-slate-200">Loading...</div>
      </div>
    </div>

    <!-- Message Box Modal -->
    <div id="msgModal" hidden class="fixed inset-0 z-50 grid place-items-center bg-black/60 p-4">
      <div class="w-full max-w-2xl rounded-2xl border border-white/10 bg-slate-900/95 backdrop-blur shadow-xl">
        <div class="px-5 py-4 border-b border-white/10">
          <div class="text-base font-semibold" id="msgTitle">Message</div>
        </div>
        <div class="px-5 py-4">
          <div id="msgBody" class="text-sm text-slate-200"></div>
        </div>
        <div class="px-5 py-4 border-t border-white/10 flex justify-end">
          <button class="btn" id="msgOk" type="button">OK</button>
        </div>
      </div>
    </div>

  </div>

  <script src="app.js"></script>
</body>
</html>
